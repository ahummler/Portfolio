if (self.CavalryLogger) { CavalryLogger.start_js(["4Ngwp"]); }

__d('FacebarDisambiguationDialog',['cx','fbt','Event','BrowseLogger','CSS','Dialog','DOM','FacebarStructuredText','FacebarTypeaheadEntityItem.react','React','ReactDOM'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=650;function k(l,m,n,o,p){'use strict';this._sets=l;this._path=m;this._ondone=n;this._oncancel=o;this._selection=[];this._typeaheadSID=p;}k.prototype.show=function(){'use strict';new (c('Dialog'))().setTitle(i._("Which of these did you mean?")).setBody(this._createBody()).setContentWidth(j).setModal(true).setButtons([c('Dialog').CONFIRM,c('Dialog').CANCEL]).setHandler(this._handleDone.bind(this)).setCancelHandler(this._handleCancel.bind(this)).show();this._sets.forEach(function(l){var m=[];l.forEach(function(o){m.push(o.uid);});var n=l[0];c('BrowseLogger').logDisambiguationImpression(n.text,n.type,this._path,m.join(','),this._typeaheadSID);}.bind(this));};k.prototype._createBody=function(){'use strict';var l=[];this._sets.forEach(function(m,n){l.length&&l.push(c('DOM').create('li',{className:"_200"}));m.forEach(function(o){var p=this._createItem(o,n);this._selection[n]||this._selectItem(p);l.push(p.root);}.bind(this));}.bind(this));return c('DOM').create('ul',{className:'viewList disambiguationList'},l);};k.prototype._createItem=function(l,m){'use strict';var n={uri:null,subtext:l.subtext,category:l.category,photo:l.photo,type:l.type,structure:c('FacebarStructuredText').fromStruct([{text:l.text,type:'ent:'+l.type,uid:l.uid}])},o=c('DOM').create('div',{className:"_201"}),p=c('React').createElement(c('FacebarTypeaheadEntityItem.react'),{result:n}),q=c('DOM').create('div');c('ReactDOM').render(p,q);var r=q.firstChild;c('CSS').addClass(r,"_6i3");c('DOM').appendContent(r,c('CSS').hide(o));var s={setId:m,result:l,root:r,check:o};c('Event').listen(r,'mouseover',this._toggleHover.bind(this,s,true));c('Event').listen(r,'mouseout',this._toggleHover.bind(this,s,false));c('Event').listen(r,'click',function(event){this._selectItem(s);return event.kill();}.bind(this));return s;};k.prototype._toggleHover=function(l,m){'use strict';c('CSS').conditionClass(l.root,'selected',m);};k.prototype._toggleCheck=function(l,m){'use strict';c('CSS').conditionShow(l.check,m);};k.prototype._selectItem=function(l){'use strict';var m=this._selection[l.setId];this._selection[l.setId]=l;m&&this._toggleCheck(m,false);this._toggleCheck(l,true);};k.prototype._handleDone=function(l){'use strict';this._ondone(l==c('Dialog').CONFIRM?this._selection.map(function(m){var n=m.result;c('BrowseLogger').logDisambiguationClick(n.text,n.type,this._path,n.index,n.uid,this._typeaheadSID);return n;}.bind(this)):null);};k.prototype._handleCancel=function(){'use strict';this._oncancel();};f.exports=k;},null);
__d('FacebarTypeaheadDecorateEntities',['arrayContains','emptyFunction'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(l){var m=[];l.forEach(function(n){if(n.isType('ent'))m.push(n.getUID());});return m;}function i(l,m){var n=null;l.structure.forEach(function(o){if(o.isType('ent')&&!c('arrayContains')(m,o.getUID()))n=o;});return n;}function j(l,m,n){l.forEach(function(o){var p=i(o,m);o.decoration={entity:p&&n.getEntryForFragment(p)};});}function k(l){'use strict';this._typeahead=l;}k.prototype.enable=function(){'use strict';this._typeahead.view.subscribe('filter',function(l,m){j(m.results,h(this._typeahead.core.getValue()),this._typeahead.data);}.bind(this));};Object.assign(k.prototype,{disable:c('emptyFunction')});f.exports=k;},null);
__d('FacebarTypeaheadDisambiguateResults',['FacebarDisambiguationDialog','FacebarStructuredFragment','FacebarStructuredText','URI','emptyFunction','getObjectValues'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(q,r){var s={};q.forEach(function(v){if(v.type=='grammar'){var w=r(v.structure).toLowerCase();s[w]=s[w]||[];s[w].push(v);}});var t=[];for(var u in s)if(s[u].length>1)t.push(s[u]);return t;}function i(q){var r=[];q.toArray().forEach(function(s,t){if(s.isType('ent'))r.push(t);});return r;}function j(q,r,s){var t={},u={},v={};r.forEach(function(x){var y=q[0].structure.getFragment(x),z=y.getHash();u[z]=u[z]||[];v[x]=u[z];q.forEach(function(aa){var ba=aa.structure.getFragment(x),ca=ba&&ba.getUID();if(ca&&!t.hasOwnProperty(ca)){u[z].push(s.getEntryForFragment(ba));t[ca]=true;}});});for(var w in v)if(v[w].length<=1)delete v[w];return v;}function k(q,r){var s={},t=[];q.forEach(function(u){var v=u.structure.getFragment(r).getUID();if(!s.hasOwnProperty(v)){s[v]=t.length;t.push([]);}t[s[v]].push(u);});return t;}function l(q,r,s){var t=q.shift();t.ambiguity.entities=r;s.push.apply(s,q);return t;}function m(q,r){var s=[],t=[],u=false;q.forEach(function(w){w.ambiguity={fragment:null,entities:null,text:null};});h(q,function(w){return w.getHash();}).forEach(function(w){var x=w[0].structure,y=i(x),z=j(w,y,r);if(u){l(w,z,s);return;}var aa=y.pop();if(typeof aa=='number'){var ba=k(w,aa);u=ba.length>1;if(u)delete z[aa];ba.forEach(function(ca){var da=l(ca,z,s);if(u){var ea=da.structure.getFragment(aa).getUID();da.ambiguity.entity=r.getEntry(ea);t.push(da);}});}});s.forEach(function(w){var x=q.indexOf(w);x!=-1&&q.splice(x,1);});h(q,function(w){return w.toString();}).forEach(function(w){w.forEach(function(x){if(!x.ambiguity.entities)x.ambiguity.text=x.queryTypeText;});});var v=q.indexOf(t[0]);t.slice(1).forEach(function(w){var x=q.indexOf(w);if(x!=-1&&x!=++v){q.splice(x,1);q.splice(v,0,w);}});}function n(q,r){var s=q&&q.ambiguity&&q.ambiguity.entities,t=s&&Object.keys(s).map(Number),u=r.core.input;if(!t||t.length===0)return false;var v=function(y){r.core.executeQuery(o(q,t,y));},w=function(){u.focus();u.input.moveSelectionToEnd();};s=s?c('getObjectValues')(s):[];var x=new (c('FacebarDisambiguationDialog'))(s,q.uri.getPath(),v,w,r.getCore().getSessionID());u.blur();x.show();return true;}function o(q,r,s){var t=q.structure.toArray(),u=new (c('URI'))(q.uri),v=u.getPath().split('/');r.forEach(function(w){var x=t[w],y=s.shift(),z=v.indexOf(String(x.getUID()));if(z!=-1)v[z]=y.uid;t[w]=new (c('FacebarStructuredFragment'))({uid:y.uid,text:y.text,type:'ent:'+y.type});});return {uri:u.setPath(v.join('/')),structure:new (c('FacebarStructuredText'))(t)};}function p(q){'use strict';this._typeahead=q;}p.prototype.enable=function(){'use strict';this._typeahead.view.subscribe('filter',function(q,r){m(r.results,this._typeahead.data);}.bind(this));this._typeahead.view.subscribe('beforeSelect',function(q,r){return !n(r.selected,this._typeahead);}.bind(this));};Object.assign(p.prototype,{disable:c('emptyFunction')});f.exports=p;},null);